<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Algor Orchestrator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .header h1 {
            font-size: 24px;
            color: #333;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            text-align: right;
        }

        .user-email {
            font-size: 14px;
            color: #999;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #5568d3;
        }

        .container {
            display: flex;
            height: calc(100vh - 70px);
        }

        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e0e0e0;
            padding: 20px 0;
            overflow-y: auto;
        }

        .menu-item {
            padding: 15px 20px;
            border-left: 3px solid transparent;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .menu-item:hover {
            background: #f5f5f5;
            color: #667eea;
        }

        .menu-item.active {
            background: #f0f4ff;
            border-left-color: #667eea;
            color: #667eea;
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .card h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th {
            background: #f5f5f5;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
                display: flex;
                overflow-x: auto;
            }

            .menu-item {
                white-space: nowrap;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Algor Orchestrator</h1>
        <div class="user-menu">
            <div class="user-info">
                <div id="user-name">–ê–¥–º–∏–Ω</div>
                <div class="user-email" id="user-email">admin@algoritmika.org</div>
            </div>
            <button class="logout-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="menu-item active" onclick="switchTab('dashboard')">üìà –î–∞—à–±–æ—Ä–¥</div>
            <div class="menu-item" onclick="switchTab('campaigns')">üìß –ö–∞–º–ø–∞–Ω–∏–∏</div>
            <div class="menu-item" onclick="switchTab('templates')">üìù –®–∞–±–ª–æ–Ω—ã</div>
            <div class="menu-item" onclick="switchTab('contacts')">üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
            <div class="menu-item" onclick="switchTab('billing')">üí≥ –û–ø–ª–∞—Ç–∞</div>
            <div class="menu-item" onclick="switchTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>

        <div class="content">
            <!-- Dashboard -->
            <div id="dashboard" class="content-section active">
                <div class="card">
                    <h2>–î–∞—à–±–æ—Ä–¥</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">1,250</div>
                            <div class="stat-label">–°–æ–æ–±—â–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">94.8%</div>
                            <div class="stat-label">–î–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">12.5%</div>
                            <div class="stat-label">CTR</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">‚ÇΩ15.50</div>
                            <div class="stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Å—ã–ª–æ–∫</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Campaigns -->
            <div id="campaigns" class="content-section">
                <div class="card">
                    <h2>–ö–∞–º–ø–∞–Ω–∏–∏</h2>
                    <div class="success-message" id="campaign-success">‚úÖ –ö–∞–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!</div>
                    <div class="error-message" id="campaign-error"></div>

                    <form onsubmit="createCampaign(event)">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏</label>
                            <input type="text" id="campaign-name" placeholder="–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∞–∫—Ü–∏—è" required>
                        </div>
                        <div class="form-group">
                            <label>–í—ã–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω</label>
                            <select id="campaign-template" required>
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω --</option>
                                <option value="template_1">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ Python</option>
                                <option value="template_2">–°–∫–∏–¥–∫–∞ –Ω–∞ Scratch</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ö–∞–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
                            <select id="campaign-channel" required>
                                <option value="TELEGRAM">Telegram</option>
                                <option value="VK">VK</option>
                                <option value="EMAIL">Email</option>
                                <option value="SMS">SMS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
                            <input type="datetime-local" id="campaign-time" required>
                        </div>
                        <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é</button>
                    </form>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ö–∞–Ω–∞–ª</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</th>
                            </tr>
                        </thead>
                        <tbody id="campaigns-list">
                            <tr>
                                <td>–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∞–∫—Ü–∏—è</td>
                                <td>Telegram</td>
                                <td><span class="status-badge status-success">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span></td>
                                <td>450</td>
                            </tr>
                            <tr>
                                <td>–ß–µ—Ä–Ω–∞—è –ø—è—Ç–Ω–∏—Ü–∞</td>
                                <td>Email</td>
                                <td><span class="status-badge status-pending">‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ</span></td>
                                <td>320</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Templates -->
            <div id="templates" class="content-section">
                <div class="card">
                    <h2>–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π</h2>
                    <div class="success-message" id="template-success">‚úÖ –®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!</div>
                    
                    <form onsubmit="createTemplate(event)">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</label>
                            <input type="text" id="template-name" placeholder="–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π" required>
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
                            <textarea id="template-text" placeholder="–ü—Ä–∏–≤–µ—Ç, {{name}}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>–ö–∞–Ω–∞–ª</label>
                            <select id="template-channel" required>
                                <option value="TELEGRAM">Telegram</option>
                                <option value="VK">VK</option>
                                <option value="EMAIL">Email</option>
                                <option value="SMS">SMS</option>
                            </select>
                        </div>
                        <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
                    </form>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ö–∞–Ω–∞–ª</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ Python</td>
                                <td>Telegram</td>
                                <td><span class="status-badge status-success">‚úì –ê–∫—Ç–∏–≤–µ–Ω</span></td>
                            </tr>
                            <tr>
                                <td>–°–∫–∏–¥–∫–∞ –Ω–∞ Scratch</td>
                                <td>Email</td>
                                <td><span class="status-badge status-success">‚úì –ê–∫—Ç–∏–≤–µ–Ω</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Contacts -->
            <div id="contacts" class="content-section">
                <div class="card">
                    <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div>
                            <h3 style="margin-bottom: 15px;">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV —Ñ–∞–π–ª</h3>
                            <button class="btn" onclick="document.getElementById('contact-file').click()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                            <input type="file" id="contact-file" style="display:none" accept=".csv">
                            <p style="font-size: 12px; color: #999; margin-top: 10px;">–§–æ—Ä–º–∞—Ç: Email, Telegram, –¢–µ–ª–µ—Ñ–æ–Ω</p>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 15px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é</h3>
                            <button class="btn" onclick="showAddContactForm()">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</button>
                            <p style="font-size: 12px; color: #999; margin-top: 10px;">–û–¥–∏–Ω –∫–æ–Ω—Ç–∞–∫—Ç –∑–∞ —Ä–∞–∑</p>
                        </div>
                    </div>

                    <!-- Add Contact Form Modal -->
                    <div id="add-contact-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000;">
                        <div style="background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
                            <h3 style="margin-bottom: 20px;">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç</h3>
                            <form onsubmit="addContactManually(event)">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="modal-email" placeholder="parent@example.com" required>
                                </div>
                                <div class="form-group">
                                    <label>Telegram ID –∏–ª–∏ @username</label>
                                    <input type="text" id="modal-tg" placeholder="@username –∏–ª–∏ 123456789">
                                </div>
                                <div class="form-group">
                                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="tel" id="modal-phone" placeholder="+7 900 123-45-67">
                                </div>
                                <div class="form-group">
                                    <label>–ò–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                    <input type="text" id="modal-name" placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
                                </div>
                                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="button" class="btn btn-secondary" onclick="closeAddContactForm()">–û—Ç–º–µ–Ω–∞</button>
                                    <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 15px;">–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ({{contactsCount}} –≤—Å–µ–≥–æ)</h3>
                    <div style="margin-bottom: 15px;">
                        <input type="text" id="contacts-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ email –∏–ª–∏ –∏–º–µ–Ω–∏..." style="width: 300px;">
                    </div>
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Telegram</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>–ò–º—è</th>
                                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                            </tr>
                        </thead>
                        <tbody id="contacts-list">
                            <tr>
                                <td>parent1@example.com</td>
                                <td>@username1</td>
                                <td>+7 900 123-45-67</td>
                                <td>–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</td>
                                <td><button class="btn btn-secondary" onclick="deleteContact(this)" style="padding: 6px 12px; font-size: 12px;">–£–¥–∞–ª–∏—Ç—å</button></td>
                            </tr>
                            <tr>
                                <td>parent2@example.com</td>
                                <td>@username2</td>
                                <td>+7 900 765-43-21</td>
                                <td>–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞</td>
                                <td><button class="btn btn-secondary" onclick="deleteContact(this)" style="padding: 6px 12px; font-size: 12px;">–£–¥–∞–ª–∏—Ç—å</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Billing -->
            <div id="billing" class="content-section">
                <div class="card">
                    <h2>üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–ª–∞—Ç–æ–π</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: #f9f9f9; padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 12px; color: #999; margin-bottom: 10px;">–í–∞—à —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;">Professional</div>
                            <div style="font-size: 14px; color: #666; margin: 10px 0;">‚ÇΩ2,999/–º–µ—Å—è—Ü</div>
                            <button class="btn" onclick="showUpgradeModal()">–ò–∑–º–µ–Ω–∏—Ç—å –ø–ª–∞–Ω</button>
                        </div>

                        <div style="background: #f9f9f9; padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 12px; color: #999; margin-bottom: 10px;">–û—Å—Ç–∞–≤–æ–∫ –Ω–∞ —Å—á–µ—Ç–µ</div>
                            <div style="font-size: 24px; font-weight: 700; color: #10b981;">‚ÇΩ5,200.50</div>
                            <div style="font-size: 14px; color: #666; margin: 10px 0;">–•–≤–∞—Ç–∏—Ç –Ω–∞ 1,000+ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                            <button class="btn" onclick="showPaymentModal()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á–µ—Ç</button>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 15px;">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                <th>–°—É–º–º–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>26.10.2025</td>
                                <td>–ü–æ–¥–ø–∏—Å–∫–∞ Professional</td>
                                <td>‚ÇΩ2,999</td>
                                <td><span class="status-badge status-success">‚úì –û–ø–ª–∞—á–µ–Ω–æ</span></td>
                            </tr>
                            <tr>
                                <td>26.10.2025</td>
                                <td>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞</td>
                                <td>‚ÇΩ5,000</td>
                                <td><span class="status-badge status-success">‚úì –û–ø–ª–∞—á–µ–Ω–æ</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings -->
            <div id="settings" class="content-section">
                <div class="card">
                    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</h2>
                    <form onsubmit="saveSettings(event)">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                            <input type="text" value="Algoritmika Partner" required>
                        </div>
                        <div class="form-group">
                            <label>Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</label>
                            <input type="email" value="admin@algoritmika.org" required>
                        </div>
                        <div class="form-group">
                            <label>Telegram Bot Token</label>
                            <input type="password" placeholder="–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω">
                        </div>
                        <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api/v1';

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        window.addEventListener('load', () => {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user.email) {
                window.location.href = '/index.html';
                return;
            }
            document.getElementById('user-name').textContent = user.email.split('@')[0];
            document.getElementById('user-email').textContent = user.email;
        });

        async function createCampaign(event) {
            event.preventDefault();
            
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å null-–ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
            const nameEl = document.getElementById('campaign-name');
            const templateEl = document.getElementById('campaign-template');
            const channelEl = document.getElementById('campaign-channel');
            const timeEl = document.getElementById('campaign-time');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
            if (!nameEl || !templateEl || !channelEl || !timeEl) {
                console.error('‚ùå –û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã');
                alert('‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º—ã: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            const name = nameEl.value;
            const template = templateEl.value;
            const channel = channelEl.value;
            const scheduledTime = timeEl.value;
            
            console.log(`üöÄ –°–æ–∑–¥–∞–µ–º –∫–∞–º–ø–∞–Ω–∏—é:`, {name, template, channel, scheduledTime});
            
            if (!name || !template || !channel) {
                alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            try {
                // –í—ã–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                if (contacts.length === 0) {
                    alert('‚ùå –ù–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏!');
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞
                const templates = {
                    'template_1': '–ü—Ä–∏–≤–µ—Ç! üëã –°–ø–∞—Å–∏–±–æ —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ Algoritmika!',
                    'template_2': 'üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Å! –ü–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 50% –Ω–∞ –≤—Å–µ –∫—É—Ä—Å—ã',
                    'greeting': '–ü—Ä–∏–≤–µ—Ç! üëã –°–ø–∞—Å–∏–±–æ —á—Ç–æ –≤—ã–±—Ä–∞–ª–∏ Algoritmika!',
                    'offer': 'üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Å! –ü–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 50% –Ω–∞ –≤—Å–µ –∫—É—Ä—Å—ã',
                    'service': 'üìö –ù–æ–≤—ã–µ –∫—É—Ä—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã! –ù–∞—á–Ω–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å'
                };
                
                const messageText = templates[template] || '–°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ Algor Orchestrator';
                let successCount = 0;
                let failCount = 0;
                
                console.log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ ${channel}...`);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∂–¥–æ–º—É –∫–æ–Ω—Ç–∞–∫—Ç—É
                for (const contact of contacts) {
                    try {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞–Ω–∞–ª–∞
                        let recipient = {};
                        let telegramId = contact.telegram || '';
                        
                        if (channel === 'TELEGRAM' && telegramId) {
                            // –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –û–ë–ê —Ñ–æ—Ä–º–∞—Ç–∞:
                            // @username - –±—É–¥–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                            // numeric_id - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
                            
                            console.log(`üìç Telegram ID: ${telegramId}`);
                            recipient = { tgId: telegramId };
                        } else if (channel === 'EMAIL' && contact.email) {
                            recipient = { email: contact.email };
                        } else if (channel === 'SMS' && contact.phone) {
                            recipient = { phone: contact.phone };
                        } else if (channel === 'VK') {
                            recipient = { vkUserId: '123456789' };
                        } else if (channel === 'WHATSAPP' && contact.phone) {
                            recipient = { phone: contact.phone };
                        } else {
                            console.warn(`‚ö†Ô∏è –ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –¥–ª—è ${contact.email} –≤ –∫–∞–Ω–∞–ª–µ ${channel}`);
                            failCount++;
                            continue;
                        }
                        
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
                        const response = await fetch('http://localhost:3001/api/v1/messages/send', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            },
                            body: JSON.stringify({
                                channel: channel,
                                recipient: recipient,
                                content: messageText,
                                templateId: template
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            console.log(`‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${contact.email}: ${data.result.messageId}`);
                            successCount++;
                        } else {
                            console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ${contact.email}:`, data);
                            failCount++;
                        }
                        
                    } catch (error) {
                        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ ${contact.email}:`, error);
                        failCount++;
                    }
                    
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const message = `‚úÖ –ö–∞–º–ø–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\n‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successCount}\n‚ùå –û—à–∏–±–æ–∫: ${failCount}`;
                alert(message);
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                nameEl.value = '';
                templateEl.value = '';
                channelEl.value = '';
                timeEl.value = '';
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–∏:', error);
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function createTemplate(event) {
            event.preventDefault();
            const name = document.getElementById('template-name').value;
            const successDiv = document.getElementById('template-success');
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 3000);
        }

        function showUpgradeModal() {
            alert('–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–ª–∞–Ω—ã:\n\n‚Ä¢ Starter - ‚ÇΩ999/–º–µ—Å—è—Ü\n‚Ä¢ Professional - ‚ÇΩ2,999/–º–µ—Å—è—Ü\n‚Ä¢ Enterprise - ‚ÇΩ9,999/–º–µ—Å—è—Ü');
        }

        function showPaymentModal() {
            alert('–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è: 5000 —Ä—É–±–ª–µ–π\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã:\n‚Ä¢ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Å—Å–∞\n‚Ä¢ –°–±–µ—Ä–±–∞–Ω–∫\n‚Ä¢ PayPal');
        }

        function saveSettings(event) {
            event.preventDefault();
            alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
        let contacts = [
            { email: 'parent1@example.com', telegram: '@username1', phone: '+7 900 123-45-67', name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤' },
            { email: 'parent2@example.com', telegram: '@username2', phone: '+7 900 765-43-21', name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞' }
        ];

        function showAddContactForm() {
            document.getElementById('add-contact-modal').style.display = 'flex';
        }

        function closeAddContactForm() {
            document.getElementById('add-contact-modal').style.display = 'none';
            document.getElementById('modal-email').value = '';
            document.getElementById('modal-tg').value = '';
            document.getElementById('modal-phone').value = '';
            document.getElementById('modal-name').value = '';
        }

        function addContactManually(event) {
            event.preventDefault();
            
            const email = document.getElementById('modal-email').value;
            const telegram = document.getElementById('modal-tg').value;
            const phone = document.getElementById('modal-phone').value;
            const name = document.getElementById('modal-name').value;

            if (!email) {
                alert('‚ùå Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω');
                return;
            }

            if (!telegram) {
                alert('‚ùå Telegram ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (username –∏–ª–∏ numeric ID)');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
            if (contacts.some(c => c.email === email)) {
                alert('‚ùå –ö–æ–Ω—Ç–∞–∫—Ç —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç (–æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è)
            contacts.push({ email, telegram, phone, name });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
            renderContacts();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            closeAddContactForm();
            
            alert('‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!\n\n–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:\n‚Ä¢ @username (–Ω–∞–ø—Ä–∏–º–µ—Ä: @myusername)\n‚Ä¢ Numeric ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5540862911)\n\n–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç @username –≤ ID');
        }

        function deleteContact(button) {
            const row = button.closest('tr');
            const email = row.cells[0].textContent;
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${email}?`)) {
                contacts = contacts.filter(c => c.email !== email);
                renderContacts();
                alert('‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç —É–¥–∞–ª–µ–Ω');
            }
        }

        function renderContacts() {
            const tbody = document.getElementById('contacts-list');
            tbody.innerHTML = '';
            
            contacts.forEach(contact => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${contact.email}</td>
                    <td>${contact.telegram || '‚Äî'}</td>
                    <td>${contact.phone || '‚Äî'}</td>
                    <td>${contact.name || '‚Äî'}</td>
                    <td><button class="btn btn-secondary" onclick="deleteContact(this)" style="padding: 6px 12px; font-size: 12px;">–£–¥–∞–ª–∏—Ç—å</button></td>
                `;
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ –º–µ–Ω—é
            const contactsMenu = Array.from(document.querySelectorAll('.menu-item')).find(item => item.textContent.includes('–ö–æ–Ω—Ç–∞–∫—Ç—ã'));
            if (contactsMenu) {
                contactsMenu.textContent = `üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã (${contacts.length})`;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV —Ñ–∞–π–ª–∞
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('contact-file');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const csv = event.target.result;
                        const lines = csv.split('\n');
                        let imported = 0;

                        for (let i = 1; i < lines.length; i++) {
                            if (!lines[i].trim()) continue;

                            const parts = lines[i].split(',').map(p => p.trim());
                            if (parts.length < 1) continue;

                            const email = parts[0];
                            const telegram = parts[1] || '';
                            const phone = parts[2] || '';
                            const name = parts[3] || '';

                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
                            if (!contacts.some(c => c.email === email)) {
                                contacts.push({ email, telegram, phone, name });
                                imported++;
                            }
                        }

                        renderContacts();
                        alert(`‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${imported} –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤`);
                        fileInput.value = '';
                    };
                    reader.readAsText(file);
                });
            }

            // –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            const searchInput = document.getElementById('contacts-search');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    const rows = document.querySelectorAll('#contacts-list tr');
                    
                    rows.forEach(row => {
                        const email = row.cells[0].textContent.toLowerCase();
                        const name = row.cells[3].textContent.toLowerCase();
                        row.style.display = email.includes(query) || name.includes(query) ? '' : 'none';
                    });
                });
            }

            renderContacts();
        });

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ù–ê–í–ò–ì–ê–¶–ò–ò
        function switchTab(tab) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            const selectedTab = document.getElementById(tab);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            // –ù–∞—Ö–æ–¥–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                if (item.textContent.toLowerCase().includes(tab.toLowerCase()) || 
                    (tab === 'dashboard' && item.textContent.includes('–î–∞—à–±–æ—Ä–¥'))) {
                    item.classList.add('active');
                }
            });
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.clear();
                window.location.href = '/index.html';
            }
        }
    </script>
</body>
</html>
